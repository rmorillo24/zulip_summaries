 Hey @*customer_success* , talking with [Lely](https://app.hubspot.com/contacts/23622378/record/0-3/13800185481) about their balena evaluation. They've requested we sign [this NDA](https://drive.google.com/file/d/1NCCYnGXUVIBDnnb3lZsx_pj6nqX5v23U/view?usp=share_link) to proceed.
Besides a 5 year no-disclosure commitment, and jurisdiction in The Netherlands, I haven't found anything that would make us reject it.
FWIW, it's a 20k devices oppty and they are liking balena so far, so I think it makes sense to go with their NDA. If you can give it a quick read and see if you agree, I'll send it to sign.
Thank you :) I agree with you @**rmorillo24 (Rafa)** , it looks fine to me. There is one thing we'll need to change and it's the balena Seattle address as it's the old one. Here it is for reference: https://balena.fibery.io/Customer_Success/Customer-Success-Documentation-639/anchor=Vendor-Form-Info-Bank-ACH-+-Phone-Number--4083f34f-60ae-40c4-af87-dd7d9cc497dd @*customer_success* I had an interesting talk with LELY about their project. I updated Hubspot with the notes, but summarizing here for everyone:

- LELY is in evaluation phase, comparing different tools
    - balena
    - [Zedada](https://zededa.com/)
    - Software AG
- They want to have a working demo by end of August
- They have 23000 devices and adding 3000 every year
- They have questions about network configuration and  SB reliability that are important for the evaluation. Besides they'd like Github automation, and a container to do USB backups on a specific usb port 

@**joehounsham** I'll be OOO next week and they asked for a backup in case they need help. Mind if I give them your email? I'll open several threads about the different topics and will link here for reference Of course @**rmorillo24 (Rafa)** , no need to ask! Sounds promising Hey @**konmouz** , I sent a Dropbox Sign request for LELY's mutual NDA. We've reviewed it and there's nothing that would prevent us from signing it. Thank you :) @**rmorillo24 (Rafa)** signed Great thanks! For those interested, LELY has shared the evaluation document for a management platform: [LELY-Edge-orchestration-platform-choice-requirements.pdf](/user_uploads/44990/zKlHDefW3tspYNCH-USD48qk/LELY-Edge-orchestration-platform-choice-requirements.pdf) As a reminder, they are evaluating balena, Zedada and Software AG Under NDA, btw... > "We are working on a new edge compute solution, to run all Lely software at the farms on Lely controlled edge hardware. This will eventually replace the current method of delivering software packages to our customers that are installed on the farmer‚Äôs existing computer.
The solution is needed on farms with Lely robots. Today there are over 20 000 farms operational. Currently all farms install the management software on Windows computers they acquire or are supplied by varied vendors."

This is so good. I haven't looks deeper at how to do "Container with USB port access for local USB backup disk" in a secure way. 
@**rmorillo24 (Rafa)**  Do you think it's worth investing some time or what we already shared would be enough for them? > Compliant with the NIS2 and CRA cyber security directives

That's interesting @_**alexgg|548778** [said](https://balena.zulipchat.com/#narrow/stream/346009-aspect.2Fcustomer-success/topic/LELY/near/384691768):
```quote
> Compliant with the NIS2 and CRA cyber security directives

That's interesting
```

Yes we need to prepare for that asap We should be able to offload as much as possible from the customer to the platform and os. 
In the same vain as buying a radio module pre-certified when you build hardware to avoid dealing with that certification yourself. > Do you think it's worth investing some time or what we already shared would be enough for them?

I'm not sure @**aethernet (Edwin)** . This is the last thing they shared about their use case:

> We likely need to look for some specific configuration files on a USB stick when it is found.
> That creates a high risk scenario for code injection if our software has a vulnerability.
> Due to this, I would feel much more comfortable knowing that the container is fully isolated, and a possible attacker cannot progress further from the container.

I told them to mount the drive in a privileged container, copy the files to a shared volume, and then use them.
If they start with a premise that their software has a vulnerability, I'm not sure what other protections we can provide. My thinking is:
- They mount a USB drive: no code is executed at this point since we don't have auto-run
- They copy the config files
- The config variable has a malicious code
- Their software is vulnerable to it. What can we do about it? Does it matter if the container is isolated or not? > Their software is vulnerable to it. What can we do about it? Does it matter if the container is isolated or not?

The attacker could take control of that container but would be limited there. Opposed to a privileged container where taking over the container would mean taking control over the entire system. I see they are planning to physically replace the Windows hardware with Linux, but it might be worth a plug of the migrator in case there are some farms that might be difficult to transition over ( remote locations etc). In addition,  Lely could actually do a small POC on their existing 'Old T4 fleet', something the competition could not offer. @**rmorillo24 (Rafa)** On the face of it the requirements look straightforward, should be an easy win :yum: I see what you mean @**aethernet (Edwin)** , but I would assume they wouldn't execute the contents of the configuration files, but maybe I'm assuming too much. I guess the risk is there. That's a good point @**joehounsham** . I'll make a list of all the things we're talking about and prepare for a followup meeting with them yeah it really depends on what they do with those files... Also @**rmorillo24 (Rafa)** I think Lely is probably out of the lead stage and should be converted to a new logo opportunity? Besides, the one thing that doesn't make it an easy win IMO, is the early stage of the Secure boot. THey already said they are not sure about the maturity of it For the oppty stage, I was going to wait for their evaluation to finish @**joehounsham** . But you are right, technically the evaluation is under New Logo Business. @**joehounsham** , I'm preparing a price simulation for LELY. They estimate 100 operators and 30 developers. Are we applying 10% discount to yearly prepayment for users in Pilot and Production? Or only Production? Never mind. I've answered myself. Only in production. If they are prepaying annually @**rmorillo24 (Rafa)** the 10% annual prepayment for seats is applicable for all plans Curious why you thought otherwise though @**rmorillo24 (Rafa)** , we should clear that up in the CS docs Well, I wasn‚Äôt sure initially. Then I remembered the website says Volume discounts on Production plans. 
If we are offering these for other plans and it encourages companies to prepaid, maybe we should try to enable it in all the plans via CC @**rmorillo24 (Rafa)** Yeah, I remember it used to but not anymore. Good shout on enabling it for customers to self-serve purchases for annual seats, however I don't think we have a way the DB can handle it ( same reasons customers cannot purchase CDS, for example) @**rmorillo24 (Rafa)** I'm feeling so much itch to respond to this like a bid. Missing my old days! If you want a friend while writing up the response, you know where to find me! And if you don't, I promise I'll forget this conversation by the time I wake up tomorrow. üòÜ Thank you @**the-real-kenna üñ®Ô∏è** ! But by the time they shared this document they were already testing and asking me things directly. THey've done their own evaluation stage and they are doing what we like them to do, which is testing by themselves. Hey @*security* @**alexgg** @**klutchell (Kyle)** . I just received this feedback from Lely and need your help answering. Today I‚Äôm having a long flight back home (I just boarded the first leg) so please excuse me if I don‚Äôt participate much.  As a reminder, Lely is a 20k devices fleet evaluating balena: 

Mail here, and thank you :)

I have some fears regarding Balena's implementation of disk encryption.
Disk encryption is a critical feature for us and we cannot proceed without it.
Firstly I am worried as the secure boot implementation for Balena is a new feature, so there is no reliability data from large deployments yet.


Secondly I foresee reliability problems with Secure Boot on a deployment at our scale.
When I worked in IT administration, I semi regularly saw Windows laptops BitLocker encryption being triggered and the laptop would not boot.
I know that there are many complex factors to that and many cases are probably explained by user actions, but I have a hard time trusting that even in a completely static environment Secure Boot would never trigger accidentally.
As we are deploying tens of thousands of systems, I would expect that we will see decryption failures regularly.

The way Balena does disk encryption means that if the decryption fails, we will loose all manageability of that edge device.
Then we have to send a technician on site to apply a recovery key to decrypt the device again.
What is Balena's reaction to this worry of mine, or can you state with confidence that this should not be expected even at large scale?


The second subject I would like to bring up is the inherent security of the solution and it's features.
We were asking for some features that I would expect to be commonplace, like attaching a container network interface into a VLAN and mounting a USB port into a container.
Finding that these features require some work to implement is not a problem, but the perceived insecurity of the implementation bothers me quite a bit.

The implementation for both of these requires a privileged container which seems like a bad development practice of secure design.
I would hope that commonplace features like this would be by default implemented in a way that does not compromise the security of the solution.
A container with network or USB access is a clear attack vector in a system, and if an attacker were to gain access to this container they would have unrestricted privileged access to the solution.


The third subject is regarding secure development principles.
At the moment my feeling of the security principles at Balena is not strong.
This is due to two main factors.
Firstly I am under the impression that secure deployment of the solution is a low priority due to disk encryption only being implemented now and not earlier in the development of the product.
Due to this factor I feel like the solution is more suitable for non critical consumer solutions, but not for a critical industrial solution like ours.

Secondly to me the proposal to make most of our containers privileged by default shows that a secure design is not considered as a priority at Balena.
Some of the suggestions we received felt insecure by design, and that makes me worry about if during product development decisions have been made without focus into secure design as well. 


I recognize I've brought up a lot of topics here, but I hope we can continue to collaborate to address this feedback.
We are still interested in evaluating Balena as a possible solution, and I hope it could be built into a secure solution for our needs.


We have an important meeting regarding this topic early on Tuesday morning, so if you can reply to even some of my concerns on Monday I would greatly appreciate that! 
I hope you have a good weekend! @**rmorillo24 (Rafa)** 

- I have no insights on the secure boot, but yes we have no real world experience running 10ks devices with disk encryption.
- I have no insights on the secure container environment on our balena engine
- Taking disk encryption as a main metric for secure development practices is a little weak. We are not only developing solutions for disk encryption enabled hardware. We have already a high level of security concerns while developing. Proofing this to a customer in a statement will just not convey how we work.
- I can understand the hesitances of Lely when we suggest to elevate the privileges of containers to solve integration issues.

From security standpoint, we may or may not reach what they ask for during their assessment... :shrug: `rmorillo24 (Rafa)` is on leave today, returning to work Monday the 2nd > Firstly I am worried as the secure boot implementation for Balena is a new feature, so there is no reliability data from large deployments yet.

That's a fact - not much to add here except to stress that Balena approaches security in a very transparent way so they will always know where they stand. All our implementation is open source and can be audited.

> Secondly I foresee reliability problems with Secure Boot on a deployment at our scale.
> When I worked in IT administration, I semi regularly saw Windows laptops BitLocker encryption being triggered and the laptop would not boot.
> I know that there are many complex factors to that and many cases are probably explained by user actions, but I have a hard time trusting that even in a completely static environment Secure Boot would never trigger accidentally.
> As we are deploying tens of thousands of systems, I would expect that we will see decryption failures regularly.

Also agreed - all deployments of tens of thousands of systems will have problems. And as per the above point, it's fair to communicate we are still working on the final solution towards PCR register locking that is secure and avoids this problem.

As a counterargument, balenaOS secure boot is automatically tested in a QEMU environment for every PR and every release, and that has proven very stable over probably hundreds of thousands of runs and counting. So if QEMU can be stable, I expect physical hardware can be too.

> The way Balena does disk encryption means that if the decryption fails, we will loose all manageability of that edge device.
> Then we have to send a technician on site to apply a recovery key to decrypt the device again.
> What is Balena's reaction to this worry of mine, or can you state with confidence that this should not be expected even at large scale?

The implementation places security first - so if the decryption fails remote manageability will be lost as the system will not boot. We do not offer a recovery boot with remote access as that will have access to the TPM and would open an attack vector on the encrypted data.

> The second subject I would like to bring up is the inherent security of the solution and it's features.

Again, our implementation is very transparent and open source, and can be independently audited. We are also open to discuss it with them.

> We were asking for some features that I would expect to be commonplace, like attaching a container network interface into a VLAN and mounting a USB port into a container.
> Finding that these features require some work to implement is not a problem, but the perceived insecurity of the implementation bothers me quite a bit.

Not sure about why they state this would be commonplace, maybe some examples would help. I seem to remember discussing this briefly in the check-in as a way to provide a secure recovery boot that would allow to access the encrypted data. We would only research this if there was more customer requests, and when we build it it will be secure.

> The implementation for both of these requires a privileged container which seems like a bad development practice of secure design.
> I would hope that commonplace features like this would be by default implemented in a way that does not compromise the security of the solution.
> A container with network or USB access is a clear attack vector in a system, and if an attacker were to gain access to this container they would have unrestricted privileged access to the solution.

Again, I think they are discussing some rough idea that has obviously not been implemented but also not shaped up. I think this is work of CS when discussing proposals to place the context appropriately - we are trying to learn about the requirement and throwing out some implementation possibilities to gather feedback. I don't have the details, but it should not be taken as some implementation decision.

As a final note, we might add that implementing secure boot and disk encryption for x86_64 has been a 2 years project for our OS team, and is still progressing as mentioned before. So I don't think we are taking it lightly.

> The third subject is regarding secure development principles.
> At the moment my feeling of the security principles at Balena is not strong.
> This is due to two main factors.
> Firstly I am under the impression that secure deployment of the solution is a low priority due to disk encryption only being implemented now and not earlier in the development of the product.
> Due to this factor I feel like the solution is more suitable for non critical consumer solutions, but not for a critical industrial solution like ours.

As above, I think they got this the other way round. The fact that it comes now only shows the care we have placed into its development - it has not been rushed in any way. It is designed to be suitable for industrial solutions.

> Secondly to me the proposal to make most of our containers privileged by default shows that a secure design is not considered as a priority at Balena.
> Some of the suggestions we received felt insecure by design, and that makes me worry about if during product development decisions have been made without focus into secure design as well. 

I have already answered this above.

> We are still interested in evaluating Balena as a possible solution, and I hope it could be built into a secure solution for our needs.

It would help if they would come with some concrete examples about the implementation that they think is subpar instead of throwing speculation about hypothetical new features. @**rmorillo24 (Rafa)** ^^ `rmorillo24 (Rafa)` is on leave today, returning to work Monday the 2nd @**rmorillo24 (Rafa)** one thing that I think needs stressing out is that our implementation is not using Microsoft keys as the first step in the trust chain - I haven't seen many out there that do, definitely not the major Linux distros like Ubuntu Core.  I think EveOS/Zededa might also not use Microsoft keys, so I think that might be the toughest competition to beat.
Just to stress the obvious - a system that uses Microsoft keys as a first step can boot any binary signed with Microsoft keys - and those can be easily bought afaik. `rmorillo24 (Rafa)` is on leave today, returning to work Monday the 2nd But if this ends up being a choice between two, I'm keen to have @**jakogut**  and @**mtoman** spend some quality time trying to break their security as a learning exercise `mtoman` is on leave today, returning to work Monday the 2nd Like, let's remove the battery see what happens :) I think in the process of developing our SB/FDE solution we've discovered a number of potential ways to circumvent the system's security, and patched or have patches in the works for all of them. I disagree with the idea that a system failing to unlock and boot in an insecure state is problematic, rather it's by design. As Alex mentioned, it's designed with security first.

If the trade off of a machine not booting after it's been tampered with is unacceptable, don't enable secure boot. Really I agree with all of Alex's points.

I'll add that we should really default to offering solutions to customers that exercise the minimum privilege level possible. Basically no application *requires* privileged access. The highest level of access any container should need is `CAP_SYS_ADMIN`.

I'm surprised it took a customer this long to take issue with the suggestion, but there are other ways to accomplish things. Here's what I understand they're concerned about:
- A.  the stability of SB/FDE because
	- A.1. It's a critical feature for them
	- A.2. It has not been battle-tested
	- A.3. Any failure would be costly (as they wouldn't be able to remotely fix)

- B. the proposal of using privileged containers for
	- B1. mounting USB drives
	- B2. setting VLAN

- C. our general security posture as
	- C1. we only releasing SB/FDE now
	- C2. we proposed a "privileged container-based" solution for their requirement
	- C3. they don't know if we follow "secure development principles" ourselves and based on the previous point they have doubts

And what I would say about those points (gathering info from the thread and adding some):

A. Stability of SB/FDE: 
- We understand that's critical for them.
- We've designed our SB implementation for best-in-class security and stability.
- It's been under development for more than two years by our OS team. It took us a long time because we didn't rush anything and we didn't cut any corners. A good example of this is how we're not using Microsoft keys for the first stage, unlike most Linux distributions.
* The hardened nature of SB, by design, will require a physical intervention in case of failure as anything else would open unacceptable attack vectors.
* balenaOS secure boot is automatically tested in a QEMU environment for every PR and every release, it has so far proven very stable over hundreds of thousands of runs and counting.
* All deployments of tens of thousands of systems will have problems, no matter the solution. 
* While testing SB across a wide range of devices with various hardware and bios, we identified the most probable causes of failure (due to the various implementations of the spec by different vendors) and are finalizing the solution towards PCR register locking to ensure maximum compatibility and stability, even in edge cases.
* As they mentioned, in a static environment, they won't have any "random" SB issues. The device will refuse to unlock if put in an insecure state even if due to failing hardware.
- Note that our implementation is open-source and can be easily audited.

B. Block Device USB mounting and VLAN
- There are multiple ways to achieve what they're looking for.
- We agree that privileged containers while being the fastest way to achieve it, are not the most secure one.
* So far, our customers who needed to mount devices found it acceptable to use privileged containers with only the job of doing the mount and then sharing files to another unprivileged container where the processing happens.
* As we're very practical regarding our roadmap and our current most security-aware customers don't have a need for mounting USB devices, we didn't optimize for the use case.
* While we assist and suggest potential implementations for our customer's applications, we favor secure yet practical solutions. Every customer has different threat models and priorities, so all we can do is offer them options.
* If this suggestion doesn't fit the security model for Lely we're happy to discuss alternatives. Including changes in the OS if it makes sense.

C. Secure development principles
- We do follow secure development best practices when developing our infrastructure and products.
- As most of our developments are open-source and done on public repositories they're welcome to have a look and perform audits and pen-tests.
- We have customers who pen-tests and audit balena during their own security assessment. While concerns raised during that assessment have been quickly addressed in the past, the latest ones didn't raise anything concerning.
- The same for the pen-test we commissioned last month. They found high-severity risks associated with our use of JWT tokens, yet on a convoluted and very impractical attack vector. We're in the process of mitigating their findings for a re-test later this month. Their conclusion was that we follow standard security practices.
- We're actively in the process of getting ready for an iso27001 certification and are committed to going through the audit in the first half of 2024.
- If they have more specific questions about our security practice and posture, we're happy to discuss them.
- We're an open-source company, they don't have to take our word for it and can audit our products. We're fully transparent, that's the best guarantee. > If this suggestion doesn't fit the security model for Lely we're happy to discuss alternatives. Including changes in the OS if it makes sense.

Maybe too much here.

@**jakogut** What do you have in mind when you say there is alternatives? It would be useful to give them more than "happy to discuss" @**aethernet (Edwin)** As I mentioned, I think the general idea would be to use the minimum privilege/capability level necessary, and isolate those capabilities to the containers/processes that need them. For example, a container that needs mount access, such as for `devtmpfs` needs at least `CAP_SYS_ADMIN`. The difference between `CAP_SYS_ADMIN` and privileged or root is small, so processes that don't need it should be run under a different user, if not a different container entirely.

Graphical applications tend to work well with the X server or Wayland compositor in a separate container, but hotplugged input devices (in my experience) tend to need `devtmpfs`. This is situational, and I think we should explain the trade offs and risks of over-privileged applications to users before recommending running everything effectively as root, or simply stop doing so altogether. `aethernet (Edwin)` is on leave today, returning to work the 9th October We don't need to solve everyone's problems, it's *their job* to build their applications. We *do* however need to provide the basic building blocks to enable them to implement the architecture they find fits best (and I think we already do this), and not recommend approaches that have known foot guns. Thank you so much for your answers guys. I will start composing an answer with the above and suggest a meeting if they feel they need to.  
And sorry again for the rush and just pasting the email and running. I tend to breakdown comments and open different threads to try help everyone, but this time I had no alternative. @**alexgg** @**aethernet (Edwin)** @**jakogut** the customer appreciates your fast response, and has answered this. No action needed on your side, I just wanted to share it with you:

> I can now understand that there is clear reasoning behind locking the device in case of a secure boot failure. I know Zededa's principle is to make sure you never loose remote manageability of a node, and they have found a way to implement that while maintaining encryption. With this explanation I can see how both ways have their ups and downs and it helps to evaluate the solutions better. `aethernet (Edwin)` is on leave today, returning to work the 9th October Also: 

> Thank you, I really appreciate the fast answer. This information does alleviate my original concerns significantly. Thank you for providing the information quickly so we can take it into consideration tomorrow.

So thanks again for your help :) @**rmorillo24 (Rafa)** It's possible they could still implement an encryption solution that would retain remote manageability.

I wonder how secure it would be to run balenaOS with secure boot and full disk encryption through QEMU using a passthrough TPM from the host on top of balenaOS without SB/FDE? What do you think, @**mtoman**? If this is doable securely, it could give customers visibility into any boot issues of their secured devices.

It's possible that they could seal the LUKS passphrase using a PCR extended with some hash of the VM configuration as well.

Looking at the [docs](https://qemu-project.gitlab.io/qemu/specs/tpm.html) briefly, it seems this may be feasible.

> Sharing the device with the host is generally not a recommended usage scenario for a TPM device. The primary reason for this is that two operating systems can then access the device‚Äôs single set of resources, such as platform configuration registers (PCRs). Applications or kernel security subsystems, such as the Linux Integrity Measurement Architecture (IMA), are not expecting to share PCRs.

I guess the main weakness would be that the host could be tampered with to gain root access, as there's no verification of the bootloader, kernel, or modules. Once an attacker has root, they can compromise the kernel, read arbitrary memory (including guest memory, containing the decrypted LUKS passphrase), etc. [This](https://lwn.net/Articles/805114/) article looks relevant. @**jakogut** I do not know how the passthrough is implemented. Does the TPM disappear from the host OS or can both access it? If the host OS does not touch it (does not update the PCRs as it boots) and only passes it through to the VM, it might be doable. AMD CPUs even have per-guest memory encryption though last time I tried it was not very straightforward to use (it worked but I had to update the VM XML manually). If the host OS touches the TPM and then forwards it to the VM, it basically just leaks details of the host into the VM. But thinking about it more, the host becomes the most interesting attack target. It does not necessarily need to be encrypted (that would make the data double-encrypted, which is the same as single-encrypted :)) but the user must understand that an attacker gaining root on the host is equivalent getting root in all of the VMs. My first feeling is that it is not more secure, just more annoying, but I would need to think about it. @**mtoman** I have similar questions. I suppose it wouldn't be the end of the world so long as the measured state in the TPM was reproducible, but any changes to the measured state would also make the guest fail to decrypt/boot.

Read the linked LWN article above, it's quite interesting. Assuming the right changes make it into the mainline kernel, KVM could actually fully isolate guest memory from the host. Depending on the approach, the hypervisor could actually "demote" the host kernel, and KVM would instead manage paging itself. Therefore, compromising the host kernel wouldn't necessarily leak any information about any running guests, as they're actually similarly isolated. Yep, AMD-SEV mentioned in the article is the feature :) I think this also raises some interesting questions about how Zededa claims to implement encryption in combination with guaranteeing remote manageability, and whether or not it's actually secure.

If it's not secure, why bother? That's reinventing Xen basically :) Sort of, KVM still reuses a lot of Linux drivers rather than reimplementing the wheel :) But yeah, demoting the host kernel and having KVM manage paging sounds an awful lot like dom0 in Xen it might evolve there slowly :) I mean secure host + swtpm VMs sound feasible. is that not what we do in AWS? Hey @**jakogut** , thanks for that idea. But they said they don't want to do workarounds and rather use a solution that's giving them what they want. They don't seem to want to develop beyond what they need Regardless of what this user wants, the idea is still interesting for others. You are right of course @**jakogut** .  I was narrow sighted by Lely at this point ... Lely has decided to continue the evaluation for a month, digging deeper into balenaOS. They've asked me for a weekly meeting that I will take to help them sort out doubts and concerns. It seems they've done it this way to Zedada and they found it helpful.
@**alexgg** @**mtoman** since the topics will be related to you most probably, and you are on the same timezone,  I may ask you to join once I know the topics. I hope you don't mind. @**rmorillo24 (Rafa)** no problem @_**jakogut|548726** [said](https://balena.zulipchat.com/#narrow/stream/346009-aspect.2Fcustomer-success/topic/LELY/near/394327712):
```quote
We don't need to solve everyone's problems, it's *their job* to build their applications. We *do* however need to provide the basic building blocks to enable them to implement the architecture they find fits best (and I think we already do this), and not recommend approaches that have known foot guns.
```

For sure! I'm biased on this customer as I kind of see them as a good candidate to define an *ideal target customer*.
So I'm taking their feedback with extra attention

(cc @**ledanois (Thomas)**) What's ideal about LELY @**aethernet (Edwin)** ? `aethernet (Edwin)` is on leave today, returning to work Monday the 9th (they seem pretty run-of-the-mill customer to me -- they've got their product and their specific concerns and that's like every other customer) - **existing fleet of 20k devices**
- migrating from windows
- **growing 3000/yrs**
- industrial context
- security expectation that match the industrial context fair enough, they do look like a good opportunity business wise, I can see why you describe them as ideal Interesting, thanks for the ping @**aethernet (Edwin)**! `aethernet (Edwin)` is on leave today, returning to work Monday the 9th @**dfunckt** also they shared their evaluation criteria and process which is very enlightening on what a customer in that position is looking for it's still a sample of 1, what piqued your interest? and I also think that migrating large fleets is the only practical way for 10x in 2yrs Just one thing @**aethernet (Edwin)** , they are not migrating from windows. They are replacing the computers and getting new ones. It can count as an existing fleet though. `aethernet (Edwin)` is on leave today, returning to work Monday the 9th indeed not technically a brownfield migration but still starting at 20k @_**aethernet (Edwin)|548795** [said](https://balena.zulipchat.com/#narrow/stream/346009-aspect.2Fcustomer-success/topic/LELY/near/394861454):
```quote
indeed not technically a brownfield migration but still starting at 20k
```

Maybe this is even more ideal. The risk of remotely migrating an OS is substituted by installing a preloaded balena device :thinking: indeed, but i don't expect we can get that lucky every time :D @_**aethernet (Edwin)|548795** [said](https://balena.zulipchat.com/#narrow/stream/346009-aspect.2Fcustomer-success/topic/LELY/near/394862220):
```quote
indeed, but i don't expect we can get that lucky every time :D
```

Don't know about you, but I'm up all night to get lucky :musical_notes: :rolling_on_the_floor_laughing: @*customer_success* a small update about Lely:

- They are considering balena more seriously because of our last answer, and because of the price
- Apparently balena is cheaper that Zedada for their use case
- But their end solution is still expensive for end customers, so they are wondering how they can have them upgrade
- For new deployments it should be ok, but they are considering option before moving forward
- This month I'll keep having weekly meetings to unblock them with implementation details. Anyone welcome to join to help or to discuss with them their use case. They are pretty open to sharing Very intereting @**rmorillo24 (Rafa)** , did they share the price of Zedada? No they didn't... but they will :) That's postive though, it's what we discussed last week and wanted to find out. > But their end solution is still expensive for end customers, so they are wondering how they can have them upgrade

But aren't their solutions quite expensive anyway? Robotic cow milkers? surely Balena is a small contributor to their overall costs I would be up for joining, but equally would do a ping to anyone on the team who has the relevant experience in the topics relevant to their usecase and what they're interested in > But aren't their solutions quite expensive anyway? 

It is expensive, and there is no problem with new users. The problem is to convince an existing customer to upgrade to the new system, since they already have one working.
Balena is not adding a lot of costs... so I wonder even more how much does Zededa add to make it relevant Got it - well I guess that's sort of their problem :laughing: joking aside - the new system surely must deliver a better exp for their end customer - otherwise why would they bother? exactly. and i think that's the issue. They are initially providing the same, and upgrading only to improve the system's management. But initially that won't offer anything new to end users I'll do a teamwide ping for the next call, with the new questions. It will be good to have someone join indeed @**joehounsham** thanks for joining the meeting. It was helpful having you there. 
Did you find the Vlan configuration you mentioned? @**rmorillo24 (Rafa)** the thread i started reading is [here](https://app.frontapp.com/open/msg_ep3ecjx?key=uctQ8o30v9rmgN3AmK9yre3duNsWa1CB) but haven't fully fleshed out if it will solve all their problems, but has some important considerations in there with regards to fleet setup. @**joehounsham** Interesting, I see that the thread is asking for macvlan support. Coincidentally I just had Schneider Electric ask for this as well. I've opened an os thread to discuss if we support this, and if it can be something Lely can use to achieve what they are looking for. @**thgreasi** I need help with an API query when you have a minute... how can I pin to a release depending on a tag's value? Can i do it in a single query or do I have to retrieve the devices and then pin each of them? @**rmorillo24 (Rafa)** you want to pin a device or a fleet? you prefer plain curl or sdk calls? They want to pin devices within a fleet with certain tag's value I think curl will be better @**thgreasi** @**rmorillo24 (Rafa)** 
```js
const [r] = await sdk.pine.get({
    resource: 'release',
    options: {
        $select: 'id',
        $filter: {
            belongs_to__application: {
                $any: {
                    $alias: 'bta',
                    $expr: {
                        bta: {
                            slug: 'thgreasinomembersorg/teststarterisolated'
                        }
                    }
                }
            },
            release_tag: {
                $any: {
                    $alias: 'rt',
                    $expr: {
                        rt: {
                            tag_key: 'tagKey',
                            value: 'tagValue'
                        }
                    }
                }
            }
        },
    }
});

await sdk.pine.patch({
    resource: 'device',
    options: {
        $filter: {
            uuid: {
                $in: ['ec6e84741be549c8dcb39f9d5bd6b393', '8947333e143d270a2ac50d98f93f13df']
            }
        },
    },
    body: {
        should_be_running__release: r.id
    }
});
```
```sh
curl 'https://api.balena-cloud.com/v6/release?$select=id&$filter=(belongs_to__application/any(bta:bta/slug%20eq%20%27<SLEET_SLUG>%27))%20and%20(release_tag/any(rt:(rt/tag_key%20eq%20%27<TAG_KEY>%27)%20and%20(rt/value%20eq%20%27<TAG_VALUE>%27)))' \
  -H 'authorization: Bearer <BEARER>'

curl 'https://api.balena-cloud.com/v6/device?$filter=uuid%20in%20(%27<UUID_1>%27,%20%27<UUID_2>%27)' \
  -X 'PATCH' \
  -H 'authorization: Bearer <BEARER>' \
  -H 'content-type: application/json' \
  --data '{"should_be_running__release":<RELEASE_ID_FROM_ABOVE>}'
```
``` tell them to try that PATCH as a GET first as well though, to make sure they will be patching the correct devices @**thgreasi** thank you but... either I explained wrongly, or you misundertood me :( sorry
They want to pin devices that have a specific tag value. And they are asking if they can do it in a single call. I'll do a test modifying the second query you sent No need to do anything until I give up :) @**rmorillo24 (Rafa)** assuming that they already have the release id, then they can do:
```js
await sdk.pine.patch({
    resource: 'device',
    options: {
        $filter: {
            device_tag: {
                $any: {
                    $alias: 'dt',
                    $expr: {
                        dt: {
                            tag_key: 'tagKey',
                            value: 'tagValue'
                        }
                    }
                }
            }
        },
    },
    body: {
        should_be_running__release: r.id
    }
})
```
```sh
curl 'https://api.balena-cloud.com/v6/device?$filter=device_tag/any(dt:(dt/tag_key%20eq%20%27<TAG_KEY>%27)%20and%20(dt/value%20eq%20%27<TAG_VALUE>%27))' \
  -X 'PATCH' \
  -H 'authorization: Bearer <BEARER>' \
  -H 'content-type: application/json' \
  --data '{"should_be_running__release": <RELEASE_ID> }'
``` again: Tell them to first try it as a GET, to avoid accidentally pinning all devices they have access to Great thanks! @**majorz** @**alexgg** , FYI Lely has shared a more complete description of their network environment in the farms. They will not have one VLAN, but several of them, and different containers should have only access to some of these VLANs
I've asked about the use of macvlan as a potential way to avoid network_mode: host on all the containers. This way each container would have one IP address in each Vlan they have access to. Initially sounded good, but they would have problems with their legacy applications [image.png](/user_uploads/44990/4kO_YIqW9XSqrOXGGHSDvW6Z/image.png) The only alternative, as pointed earlier by Alex, would be having a firewall that would restrict the unwanted connections. They find this option unmanageable in the long run. @*customer_success* Lely has invited us to have an onsite meeting with their team near Amsterdam. Apparently they‚Äôve done the same with Zedada and they would like to have the chance to do the same with is us that they can raise some points regarding architecture, development, etc‚Ä¶ 
I‚Äôm assuming Zedada has pushed for their meeting as a way to do some presales. sooo game A right?
Since we don‚Äôt usually do this, what do you guys think? Is there anyone who would like to do a day trip to Amsterdam to meet them next week?  We can always do a remote meeting of course. I‚Äôm always for f2f meetings @**rmorillo24 (Rafa)** , I would suggest seeing if an engineer would be able to attend, but it is quite short notice. It‚Äôs an hours flight for me so I‚Äôm also happy to attend. I could see some of my customers (TAPP) at the same time.. `rmorillo24 (Rafa)` is on leave today, returning to work Friday the 17th It‚Äôs actually in Maassluis, hour or so  train from Amsterdam and 2.50 hours from @**fisehara** @**rmorillo24 (Rafa)**  @**joehounsham** as much as I‚Äòd like to support I think I know too less for the questions and concerns Lely has raised so far. `rmorillo24 (Rafa)` is on leave today, returning to work Friday the 17th If you see value in attending I‚Äôm all in, Netherlands üá≥üá± are always my destination of choice üòâ As long as there isn‚Äôt a major technical blocker that means we therefore go there and present but there‚Äôs little chance they‚Äôll choose us I‚Äôd say it‚Äôs a worthwhile exercise. Also you could dial in relevant engineers remotely @**rmorillo24 (Rafa)** `rmorillo24 (Rafa)` is on leave today, returning to work Friday the 17th @**fisehara** this meeting will be more on the development side, and not so much on the security side of things. The idea is to meet with the guys developing their app There is always value having you btw:) Are you able to make it yourself @**rmorillo24 (Rafa)** ? `rmorillo24 (Rafa)` is on leave today, returning to work Friday the 17th As in, not on your own but are you actually available to go next week, is it a pain to get there? Im trying to figure out @**joehounsham**   I‚Äôm not sure yet I think it's a great idea to do more face to face meetings when reasonable and possible. It worked well for me with Raydiant in establishing a closer relationship. Just make sure you have some enjoyment after your jobs are done ;) Alright, well I will keep those dates free. It's probably not worth me going on my own and having you dial in remotely. @**joehounsham** since I‚Äôm not sure, why don‚Äôt you pick a date, maybe with @**fisehara** if he wishes to go, and then I‚Äôll see if I join remotely. The only day I won‚Äôt be able will be Monday I'll not be able to go next week, as I'm at the OWASP conference from 22-24 If next week isn't possible, before jumping to the remote option I'd suggest the following week, it might reveal some motives on their side - If they are serious about using us, they'll make the timing work for F2F. Let me ask In case you need more encouragement, F2F sounds smart BTW looking forward to learn more how we differenciate from Zededa! asking for a friend :stuck_out_tongue: @**fisehara** @**joehounsham** what do you think about these dates?

Monday 27th, 15:00-17:00
Tuesday 28th , 14:00-16:00
Wednesday 29th , 10:00-12:00 CET times btw @**rmorillo24 (Rafa)** should work for me, let me know when I'm needed. `rmorillo24 (Rafa)` is on leave today, returning to work Friday the 17th @**joehounsham** depending from where you travel the Eurostar could be an option as it's Going directly to Rotterdam Mainstation, from there either Public or Cab will go to Maassluis. Oh really good point @**fisehara** @**fisehara** @**joehounsham** shall we set Tuesday 28th? SGTM @**rmorillo24 (Rafa)** `rmorillo24 (Rafa)` is on leave today, returning to work Friday the 17th @**rmorillo24 (Rafa)** Yeah sounds good to me, too. I can travel their by Flixbus directly from D√ºsseldorf, the trains are a mess. `rmorillo24 (Rafa)` is on leave today, returning to work Friday the 17th I'm planning to train in > arrive 1pm in Rotterdam.   Fly out, (probably) the day after @**joehounsham** @**rmorillo24 (Rafa)** so should I book my travel now? I propose that we take a cab from Rotterdam Mainstation all together, it's 30minutes to their office from there. `rmorillo24 (Rafa)` is on leave today, returning to work Friday the 17th And we need to prepare the topics with folks from OS / near hardware engineers as I expect question for this. I don't want to be there and just acknowledge questions but want to touch ground as much as possible @**fisehara** the meeting is confirmed for the 28th so it‚Äôll be safe to book tickets. Next need we can prepare everything as I know all the topics we discussed @**rmorillo24 (Rafa)** @**joehounsham** scheduled I'll be at Rotterdam Centraal at 12:15 local time (CET) `rmorillo24 (Rafa)` is on leave today, returning to work Friday the 17th I'll go back 18:20 from Rotterdam, I just have to make sure to leave Lely around 17:15 by cab to head to Rotterdam Centraal to get on a train. @**fisehara** @**rmorillo24 (Rafa)** From Lely: 
Can we reschedule for later that week as two of the team aren't around on those dates ? It's no problem for me `rmorillo24 (Rafa)` is on leave today, returning to work tomorrow, the 17th @**joehounsham** I only can offer 29.11 Wednesday or 30.11 Thursday. On 01.12 Friday I have a day off I'll have a cancellation fee on the bus ticket of 10% (1.6Euro :rolling_on_the_floor_laughing:) Your choice @**joehounsham** Let's see which option they prefer @**rmorillo24 (Rafa)** From Lely, cc @**fisehara** 

It seems they are only back on Friday 30th.
This timeline is starting to be quite late for us, as we are aiming to make our orchestration platform decision before the end of the month.
Although it would be really nice to have you here, we should also consider holding the meeting online if that means we can have it next week.

The times that would work well for us next week:

Monday 20.11. 10:00-12:00 CET
Tuesday 21.11. 10:00-12:00 CET
Tuesday 21.11. 15:00-17:00 CET
Wednesday 22.11. 10:00-12:00 CET

It is still possible to hold the meeting later when you can join us here, although it is a bit late for us:

Friday December 1st 14:00-16:00 CET
Monday December 4th 10:00-12:00 CET
Wednesday 6th 15:00-17:00 CET `rmorillo24 (Rafa)` is on leave today, returning to work tomorrow, the 17th Mannn I don‚Äôt know guys‚Ä¶ I guess we should do it online next week and then if we want to do a visit we go. Even if it‚Äôs not going to decide anything Feels like they have decided already but need to hear us out once more for the protocol of a vendor due diligence. Potentially not worth investing onsite extra efforts. 
Next week I'm out Wed 22.11 until 24.11 EOD for OWASP conference in Hasselts Belgium @**rmorillo24 (Rafa)** @**joehounsham** when did they ask for the onsite meeting? `rmorillo24 (Rafa)` is on leave today, returning to work tomorrow, the 17th @**fisehara** these are the slots for next week. Initially online but I guess they wouldn‚Äôt mind onsite:

Monday 20.11. 10:00-12:00 CET
Tuesday 21.11. 10:00-12:00 CET
Tuesday 21.11. 15:00-17:00 CET
Wednesday 22.11. 10:00-12:00 CET I honestly don‚Äôt know if they have made a decision yet. But because of difference in pricing. Let me know what you decide, I can only make onsite  possible Tuesday 15-17 @**fisehara** on site suggestions were:

Friday December 1st 14:00-16:00 CET
Monday December 4th 10:00-12:00 CET
Wednesday 6th 15:00-17:00 CET If remote, @**rmorillo24 (Rafa)** it's your call but i'd opt for the later slot to get as much preparation in as possible `rmorillo24 (Rafa)` is on leave today, returning to work tomorrow, the 17th But Friday 1st December is ok for me As mentioned on 1st dec I can‚Äôt as I have a day off @**rmorillo24 (Rafa)** Your call wether we go for Monday 4th or just do it remote `rmorillo24 (Rafa)` is on leave today, returning to work tomorrow, the 17th Since they are not answering to you email, @**joehounsham** I suggest we just schedule a remote session.
They will decide next week, and I don't think they will decide based on seeing us there... not that we have not collaborated so far anyway
The situation is that Mikko 's team is defending the business plan, and the C's are challenging the project in many diffferent ways. The main blocker for them is the ROI, and not only for balena vs. zededa, but for the whole project apparently. Using balena would alleviate costs here, but the problems would still be there.
So let's do our best to help them next week to get more data points, and let's see what happens `joehounsham` is on leave today, returning to work Monday the 20th SGTM @**rmorillo24 (Rafa)** omg... now the only slot we could make it online all of us is busy for them :/
And they are proposing dates where we can't... @**fisehara** @**joehounsham** I'm talking to Mikko to see if we can finalize a slot. Tuesday 5th 1300 to 1500 is the preferred date. I've booked the slot and see if we can make it I'll make the timing work either way @**rmorillo24 (Rafa)** @**joehounsham** I spoke with Mikko again. We are going to schedule an online meeting for this friday, meet the team, and at the same time, leave the option scheduled for Dec 5th for a wider team meeting if needed @**fisehara** @**joehounsham** ... last attempt for an onsite meeting with Lely on Dec 5th. Would you be able to make it? Should be okay, the cities will be full as 5th of Dec is [Sinterklas](https://en.wikipedia.org/wiki/Sinterklaas) Most likely won't interfere with our  travels. @**rmorillo24 (Rafa)** ^ Nice thing. Both... that you can make it and the celebration :) Yes, I‚Äôll have to come back here straight after but I‚Äôll make it @**fisehara** , @**aethernet (Edwin)** , Lely is asking for news about the Pentest report. Are we ready to share it with them? They are closing the platform selection, and they‚Äôd like to have it due to their internal process @**rmorillo24 (Rafa)** No news, we should expose the initial report. https://drive.google.com/file/d/1syTHkMRPdxZmmP7Fhf_HiGLwHWxdurGS/view?usp=share_link Ok‚Ä¶ I was asking for it :) I‚Äôll share it with them We already have an NDA in place Just a question @**fisehara** ‚Ä¶ when they ask me for those two detected risks‚Ä¶ are they solved or considered improbable ? improbable, mitigated and in the process for retesting (afaik) Made the intro to Winnow @**rmorillo24 (Rafa)** Great thanks Joe. I'll send the contact to Lely Oh, I see you just did :) @**rmorillo24 (Rafa)** Did Lely confirm a time for the meeting on the 5th? I see a calander invite for both the 4th at 9am and the 5th? @**joehounsham** we discussed in the 5th. I don‚Äôt remember the 4th, or maybe it was because we mentioned it. I‚Äôll ask and see ‚Ä¶ I wasn‚Äôt even aware of the 4th one so better check I see Monday the 4th at 9am, which will be a push. The afternoon slot means we wouldn't need to come the day before @**rmorillo24 (Rafa)** J@the invite has been updated for the 5th @**joehounsham** @**fisehara** 
We‚Äôre invited for early lunch Excellent, will book my plane / train @**rmorillo24 (Rafa)** @**joehounsham** should we still meet in rotterdam mainstation and take a cab from there? I can make 12:15 rotterdam (plus delay :rolling_eyes:)
Cab should take 30 minutes to Lely. Alternative is, renting a car and picking you up Rotterdam Mainstation and then go to Lely in the rental I'm not in favour for the own driving, though. Let me check what tickets I can get. Im far and don‚Äôt have many options Amsterdam Schipol to Rotterdam is only 30 min train, booking the intercity: https://www.ns.nl/reisplanner/#/?vertrek=Schiphol%20Airport&vertrektype=treinstation&aankomst=Rotterdam%20Centraal&aankomsttype=treinstation&type=aankomst&tijd=2023-12-05T12%3A09&firstMileModality=PUBLIC_TRANSPORT&lastMileModality=PUBLIC_TRANSPORT&ritnummers=9232 What's your travel route like @**rmorillo24 (Rafa)** ? I saw their email about SAMl / AD, I pinged @**otaviojacobi** on this the other day FYI @**joehounsham** I'm flying to Schipol. But haven't decided if arriving at 9:30 or 11:30. Then back at 7pm. I'll die because I'm 1hr away from the airport here :( > I saw their email about SAMl / AD, I pinged @otaviojacobi on this the other day FYI

I was looking for this info right now I believe it's safe to say it will be ready next year. If Enpal is also looking for this, I guess we have enough appetite for it What I do need to tell them is about the Enterprise plan requirement. @**otaviojacobi** , Lely is mentioning this regarding integration with their Azure AD: `We also need to utilize the multi factor authentication and conditional access already in use in our organization`

I didn't read anything about this in the [Improvement](https://balena.fibery.io/Work/Improvement/SAML-Integration-For-Balena-Cloud-Authentication-184). The way the MVP is defined, do you think this requirement will be met? my understanding is that if they use saml, everything (multi factor auth etc) will be handled by themslves so it is up for them to implement it on their IDP @**fisehara** @**joehounsham** I'm finally flying on monday and will spend the night there. There's 1 hour from Rotterdam's Central station to Lely. So Harald's idea of meeting on the train station is good @**rmorillo24 (Rafa)** I'm still seeing the invite scheduled for Mondy the 4th.. and i can't find the email from Mikko confirming it's Tuesday the 5th @**joehounsham** I see it in your calendar for the 5th, and I see you in the invite Check if this is the email: https://app.frontapp.com/open/msg_uum02a5?key=-7xJGihA1sNnGtYDAJfnLH2SvJatPMMV You are right though that it still shows on the 4th on you calendar. I Can't think of why you still have it there Ok @**rmorillo24 (Rafa)** I am booking my flight for Tuesday the 5th @**joehounsham** @**fisehara** , Lely can arrange transport from the metro station to their office if we tell them when we'll be there. It's a 25-30 minute walk otherwise At what time will you be arriving Joe? @**rmorillo24 (Rafa)** If I go from Rotterdam Mainstation by Cab to Lely I'll make it fro 13:00 and can take a Non-stop bus (what I prefer) If you want to go by Metro I'll need to be earlier and take trains to Rotterdam (2 switches, not preferred) I don't have a preference for the metro @**fisehara** . Taxi from the main station sounds good to me. @**rmorillo24 (Rafa)** Arriving around 10am to AMS, then a 40 minute train so I expect I'll be there around 12 @**rmorillo24 (Rafa)** @**joehounsham** I guess we're then not joining them for a early lunch, as 13:00 is the workshop session ;) @**joehounsham** @**fisehara** As I'll be in Rotterdam sleeping, I could go earlier to have lunch with them. wdyt? How early do they have lunch :joy: Me being from spain... at my breakfast time I guess hahah true I should be there at 11:36 in Rotterdam So I guess if they are having lunch before 12 then it'll be just you I'm talking to them now. I'll check their plans @**rmorillo24 (Rafa)** I'll be 11:25 in Rotterdam (no delays taken into account) 
[image.png](/user_uploads/44990/8P8zfbACS31VCccuKOdJ_wRt/image.png) @**stream** , good news here: LELY has decided to use balena for their 25k-ish fleet, pending legal and procurement negotiation.
But they have two conditions as a result of the evaluation. Quoting them:

````
- In order to implement our networking on Balena OS, we need the Macvlan driver in Docker. We hope to have this available in Q1 2024
- Before shipping our product, we need Single Sign On support in Balena Cloud so that we can integrate into our existing user identities in Azure AD with our own MFA for logins. We hope to have this available in Q3 2024
````

I'll make sure I include these in the betting table, as they are important for them as for other users.
Note: I never promised deadlines... I just gave an idea and they are setting those dates themselves.
Comments welcome. Wonderful cc @**otaviojacobi** regarding SAML Well done @**rmorillo24 (Rafa)**! Any idea what their growth rate is expected to be like? @**rmorillo24 (Rafa)** cc @*dashboard-devs* big reason to get the paginated devices table improvement done ^ That's great, @**rmorillo24 (Rafa)** !

Concerning this point:

> In order to implement our networking on Balena OS, we need the Macvlan driver in Docker. We hope to have this available in Q1 2024

If you want to add to your pitch, [this is the commit that removed macvlan](https://github.com/balena-os/balena-libnetwork/commit/776a43e28a823253ea6a8e9373163fdce4cb420e) (and other network drivers). Adding it back should be simple enough -- testing it perhaps not so much, I don't know.

I'd say it's an ideal task for new Engine contributors, especially if this new contributor has more of a clue about networking than I do (i.e., pretty much everyone :-P) Thanks @**aethernet (Edwin)** , but this is teamwork. Thanks to everyone helping here! That‚Äôs good info Leandro. I‚Äôm adding that to the pitch. Congratulations! The intelligent persistence of of yourself and other paid off. Nice! Do you know what the expected TCV is likely to be @**rmorillo24 (Rafa)** @**phil-d-wilson** what is a TCV? Pending some conversations, around $300k @**phil-d-wilson** . Not until 1 year from now when they start growing though‚Ä¶ still need to migrate their app, outsource hardware, etc. Total Customer Value @**fisehara**   In annual terms Good work @**rmorillo24 (Rafa)** !!! Heroic effort Sen√µr! > If you want to add to your pitch, this is the commit that removed macvlan (and other network drivers). Adding it back should be simple enough -- testing it perhaps not so much, I don't know.

@**lmbarros (Leandro)** Any reason why the testing would be hard? Thinking out loud - They could help us test it? Make a release and give it to them? @**vipulgupta2048** I didn't mean it will necessarily be hard, I really don't know. I am not sure how to setup a test scenario that would properly mimic a real-world use case. (Actually I just learned about macvlan a couple of weeks ago.)

> They could help us test it? Make a release and give it to them?

Yes, I think so. Still, would be much better if we also had this knowledge in house, IMO, because we are responsible for it once released. @**otaviojacobi** I've moved this research [topic](https://balena.fibery.io/Inputs/Research/Scope-SAML-authentication-MVP-243) to To Pitch, at least temporarily while we sort out things. I need to have in under the radar as it is important for Lely, Enpal and some others.
Besides, if we can have a chat to pick up your brains on it... would you mind if I look for a slot? True that, let me know if you need any help. @**rmorillo24 (Rafa)** now that file upload is done, i am switching my focus fully into saml auth, i plan on pitching a research the correct approach to do it this monday @_**myarmolinsky|548809** [said](https://balena.zulipchat.com/#narrow/stream/346009-aspect.2Fcustomer-success/topic/LELY/near/404688977):
```quote
cc @*dashboard-devs* big reason to get the paginated devices table improvement done ^
```

Should we get this pitched to make it intentional? Fleets are growing and we've received complains from more than one. Hey @**rmorillo24 (Rafa)** yesterday we spoke about LELY sending us their HW for testing, since they are EU-based, you can offer them shipping directly to me, let me know if that works for them or if you need the address or anything else. That sound good @**mtoman** . I'll talk to them about this today or next week while I'm there. I'll ping you once I know what they want to do `mtoman` is on leave today, returning to work Monday the 4th @**joehounsham** @**fisehara** I think I'll go earlier that you to Lely's. I'd like to talk to Mikko and see if I can get more information about Zedada. I hope I don't need to invite him to a dinner for that :grinning_face_with_smiling_eyes: `fisehara` is on leave today, returning to work Monday the 4th @**rmorillo24 (Rafa)** makes perfect sense, leverage that you are there already tomorrow morning. I hope that all trains are running smoothly tomorrow, although I can see that 5cm snow are tricky to handle (not) :rolling_eyes: 2023-12-05 Lely Harald Notes

# Sentiment:  All present engineers are bought into balena as the solution, not a top down decision. The team decided to use balena and is looking forward to it. They even said that this will be a fun project to work on with balena. 

# Talking points
- Lely has actively decided for balena because of features and development process:
  - At Zededa every container is a single deployment entity. Not services are deployed but containers. 
  - Although Zededa has more features, Lely has decided that they most likely won't need them in the future:
    - Run virtual machines on the edge. That allows deploying a VM with different Edge orchestration solutions, like K3S, AWS, Azure, ... 
    - Clustered edge storage so that many devices in one installation share the same storage. 
      - Lely assessed that as unlikely as the 95% of their installations are so small that only one balenaOs device will be installed and deployed to the customer.
      - That is industry High Availability Feature like continuos flow manufacturing... oil, rigs, .... Having hot-redundant systems to jump in with automatic takeover
    - Offline Update: Pull a 'state' binary that contains everything, config, metadata, image data, ...
- Hard requirement for Azure AD SSO and access management in Azure AD to assign roles in Azure that are mapped / linked with the roles in balena: admin, developer, observer.
    - No need to have fine granular permissions right now

- Hard requirement macvlan
- Are only focussing on x68/aarch64 with TPM modules

## Provisioning process at Lely as understand during the meeting:
- Device will be shipped to a customer / technician brings it there.
- There will be some kind of a license key to every installation. 
- Device will provision and will report / write this license key into a balena tag / device environment variable
- Device is assigned to customer by this license key it reports
- They really like that the device can do self-provisioning including talking to balena-api and set TAGs and ENVs


## Offline Mode (not a concern of balena - yet)
- there are rare installations 5% that are offline for several reasons:
  - religious reasons of the farm owner
  - infrastructure
  - these installations will update with a technician that provides internet access
- Lely will implement a solution that even offline devices can be restored in case of a device exchange or device damage
  - Devices have a backup USB SSD that itself is not encrypted but files on it will be encrypted
  - New device will plug in the USB SSD and encrypts the backups and restored the DB into the DB volume running on the encrypted devices internal SSD.

## Organization of development and deployment:
- Lely has test farms and evaluation farms, they will run latest software
- afterwards the software will be rolled out to a bigger group of customers
- until all devices are set to update

### Orchestration
- Balena controller will be the orchestrator of many local devices:
  - Milking robot, feeding robot, broom robot, cleaning robot
  - Each will have impact on the balena release, Lely is wondering how to optimise the release mess when rollback of one service but no the others is needed: 
    - They are fine with creating new releases and pin to newer releases which contain rolled back version of single robot services.
    - They wonder how to split the docker-compose file for each service to make development easier:
       - They are fine with multiple yaml files that merge into a balena conform docker-compose file and the conform compos file is pushed to create a release
  - That was more a talking discussion than a request to balena to implement stuff, just wanted to share the idea of single service roll backs?

## Security Concerns:
- Mainly regulation NIS2 (Network and Information Security Directive) / CRA (Cyber Resilient Act)
- Single concerns as currently the solution is running on farmers laptops / computers without any isolation, cybersecurity implementations
    - Have had a case of hack with encryption-bot:
       - Lely region technicians laptop was compromised, this laptop held team-viewer credentials for 5 farmers laptops. those five laptops got encrypted and blackmailed as hack. 

# Open questions:
- PublicUrl mapped to custom service port and not 80 as Lely needs 80 locally and that's not something that should be accesisble on the publicUrl
  - Lely will implement a service / technician service that will be exposed to remote access and they wonder if it can be exposed on different than port 80 @**rmorillo24 (Rafa)** @**joehounsham** please correct ^ if I understood topics wrong > religious reasons of the farm owner 

ü§î they have robots in the farm but no internet ü§∑‚Äç‚ôÇÔ∏è 

Single service roll back sounds a lot like multi app, which aligns nicely @**fisehara** , just to add to the notes about the multiple services: they have three main services, which are developed by three different teams. As each is developing and releasing at a different cadence, pushing different releases to a common testing environment may prove difficult rolling back and detecting what needs to be rolled back.
As you say, nothing we can help as of now. Multiapp will help, but they will still need to come up with some internal process to coordinate efforts [FBD45D71-5FEA-4BAE-963E-BE25B77DF8FF.jpg](/user_uploads/44990/WwGBdMJTRmNB_c2sWvfkRd-Z/FBD45D71-5FEA-4BAE-963E-BE25B77DF8FF.jpg)

[6CE15ECC-D2CF-40C1-BDFD-19038F2B5D9F.jpg](/user_uploads/44990/P2AKfhdG781wOQ7o_KbniZWn/6CE15ECC-D2CF-40C1-BDFD-19038F2B5D9F.jpg)

[65AA59CB-414E-45E4-8EEB-C8456DE6C7CA.jpg](/user_uploads/44990/s0SBMLLIeeni9hYT_SUJpAno/65AA59CB-414E-45E4-8EEB-C8456DE6C7CA.jpg) And those are some of the robots that communicate to the balenaOS controller. The milking robot is a nice piece of engineering. Learning how cows go autonomously in there when they need it, and how the device detects the cow, plugs in, analyzes the milk, etc... that was an interesting learning I've also forgot some learnings from Lely Mikko and the team shared with us:
Farm Environment
- Lely aims for standard PCs (Intel NUC / Asus NUC) no industry ready once for cost and price acceptance reasons from the farmers
  - They back this decision by learning that the Farmers PCs that currently run the Lely Software have no big issues with: Humidity, Insects or Dust at the Farms. They do have problems with Ammonia gas saturated Air but that are rare conditions. 
- They have the real threat of Lightning strikes, for which reason all their machineries are somehow protected against electric surges, still they need to backup regularly as the balena device may be damaged by lighting damage. > still they need to backup regularly as the balena device may be damaged by lighting damage.

They have offsite backup? When the device is online they backup the data to their cloud, if the device is offline they have the ssd to backup. > Multiapp will help, but they will still need to come up with some internal process to coordinate efforts

@**rmorillo24 (Rafa)** each team builds their service as a block, and the docker compose file pulls them together for the release. Then they can use versioning as the pinning and/or rollback method. Yes, but... if each team is releasing different versions of each block at a different cadence, they have the problem of knowing which release of which service broke the mix. You are right that blocks will help build (the same as multi app I guess. In the end, it's a problem on their end to coordinate and figure it out. The main question was, how do they rollback a single service to a previous version and our fleet-release procedure is: create a new release and rollback the service version / block in this new release. Like a git revert that is not deleting the commit but reverts the changes from the commit but creates a new commit for this But they'd need to test all the combinations unless they come up with a different release strategy. I think that's why Mikko was proposing the weekly "official" release. The problem you describe is inherent to the situation where ‚Äúeach team is releasing different versions at a different cadence‚Äù They‚Äôd have the same problem whether they used us or a custom solution or whatever With what Phil describes they get all the tools they need to manage whatever internal policy they come up with to coordinate Indeed. And to be clear, they were not asking us to solve their problem. They seem to understand what we offer and how they can use us. For once, I wasn't asking anyone here to do anything :grinning_face_with_smiling_eyes: Sweet. And to be clear, neither did I dismiss the problem, just wanted to point to where I think the solution currently lays